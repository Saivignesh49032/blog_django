{% extends 'blog/base.html' %}

{% block extra_head %}
<meta property="og:title" content="{{ post.title }}" />
<meta property="og:description" content="{{ post.content|truncatewords:30 }}" />
<meta property="og:url" content="{{ request.build_absolute_uri }}" />
<meta property="og:type" content="article" />
{% endblock %}

{% block content %}
<div class="post-detail-container">
    <article class="post-article">
        {% if post.image %}
        <div class="post-hero-image">
            <img src="{{ post.image.url }}" alt="{{ post.title }}">
        </div>
        {% endif %}

        <div class="post-content-wrapper">
            <header class="post-header">
                {% if post.category %}
                <span class="category-pill">{{ post.category.name }}</span>
                {% endif %}
                <h1 class="post-title">{{ post.title }}</h1>
                <div class="post-meta">
                    <span class="author">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path
                                d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z" />
                        </svg>
                        {{ post.author }}
                    </span>
                    <span class="separator">‚Ä¢</span>
                    <span class="date">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path
                                d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z" />
                        </svg>
                        {{ post.pub_date|date:"F d, Y" }}
                    </span>
                </div>
            </header>

            <div class="post-body">
                {{ post.content|linebreaks }}
            </div>

            <!-- Engagement Section -->
            <div class="engagement-bar">
                <!-- Like Section -->
                <div class="like-section">
                    {% if user.is_authenticated %}
                    <form action="{% url 'blog:post_like' post.pk %}" method="POST" class="like-form">
                        {% csrf_token %}
                        <button type="submit" class="like-button">
                            {% if user in post.likes.all %}
                            <span class="heart-icon liked">‚ù§Ô∏è</span>
                            {% else %}
                            <span class="heart-icon">ü§ç</span>
                            {% endif %}
                            <span class="like-count">{{ post.likes.count }}</span>
                        </button>
                    </form>
                    {% else %}
                    <div class="like-disabled">
                        <span class="heart-icon">ü§ç</span>
                        <span class="like-count">{{ post.likes.count }}</span>
                    </div>
                    {% endif %}
                </div>

                <!-- Share Section -->
                <div class="share-section">
                    <button class="share-trigger">
                        <svg width="18" height="18" viewBox="0 0 16 16" fill="currentColor">
                            <path
                                d="M13.5 1a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.499 2.499 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5zm-8.5 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zm11 5.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3z" />
                        </svg>
                        Share
                    </button>
                    <div class="share-dropdown">
                        <a href="https://api.whatsapp.com/send?text={{ post.title|urlencode }}%0A%0A{{ request.build_absolute_uri|urlencode }}"
                            target="_blank" class="share-btn whatsapp">
                            <span class="icon">üí¨</span> WhatsApp
                        </a>
                        <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ request.build_absolute_uri|urlencode }}"
                            target="_blank" class="share-btn linkedin">
                            <span class="icon">üíº</span> LinkedIn
                        </a>
                        <button
                            onclick="navigator.clipboard.writeText(window.location.href); this.innerHTML='‚úì Copied!';"
                            class="share-btn copy">
                            <span class="icon">üîó</span> Copy Link
                        </button>
                    </div>
                </div>
            </div>

            <!-- Author Actions -->
            {% if user == post.author %}
            <div class="author-actions">
                <a href="{% url 'blog:post_edit' post.pk %}" class="btn-action edit">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path
                            d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z" />
                    </svg>
                    Edit Post
                </a>
                <a href="{% url 'blog:post_delete' post.pk %}" class="btn-action delete">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path
                            d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z" />
                        <path fill-rule="evenodd"
                            d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z" />
                    </svg>
                    Delete Post
                </a>
                {% if user.is_staff %}
                <form action="{% url 'blog:clear_likes' post.pk %}" method="POST" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn-action clear-likes" onclick="return confirm('Clear all likes?');">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path
                                d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1H2.5zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5zm3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0z" />
                        </svg>
                        Clear Likes
                    </button>
                </form>
                {% endif %}
            </div>
            {% endif %}

            <!-- Comments Section -->
            <section class="comments-section">
                <h2 class="section-title">
                    <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
                        <path
                            d="M2.678 11.894a1 1 0 0 1 .287.801 10.97 10.97 0 0 1-.398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8.06 8.06 0 0 0 8 14c3.996 0 7-2.807 7-6 0-3.192-3.004-6-7-6S1 4.808 1 8c0 1.468.617 2.83 1.678 3.894zm-.493 3.905a21.682 21.682 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a9.68 9.68 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7-3.582 7-8 7a9.06 9.06 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105z" />
                    </svg>
                    Comments ({{ comments.count }})
                </h2>

                <div class="comments-list">
                    {% for comment in comments %}
                    <div class="comment-card">
                        <div class="comment-header">
                            <div class="comment-author">
                                <div class="avatar">{{ comment.user.username|first|upper }}</div>
                                <div class="author-info">
                                    <strong>{{ comment.user.username }}</strong>
                                    <span class="comment-date">{{ comment.created_on|date:"M d, Y" }}</span>
                                </div>
                            </div>
                        </div>
                        <div class="comment-body">
                            {{ comment.body|linebreaks }}
                        </div>
                    </div>
                    {% empty %}
                    <div class="empty-state">
                        <svg width="48" height="48" viewBox="0 0 16 16" fill="currentColor" opacity="0.3">
                            <path
                                d="M14 1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H4.414A2 2 0 0 0 3 11.586l-2 2V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12.793a.5.5 0 0 0 .854.353l2.853-2.853A1 1 0 0 1 4.414 12H14a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z" />
                        </svg>
                        <p>No comments yet. Be the first to share your thoughts!</p>
                    </div>
                    {% endfor %}
                </div>

                <div class="comment-form-card">
                    <h3>Leave a Comment</h3>
                    {% if user.is_authenticated %}
                    <form method="post" class="comment-form">
                        {% csrf_token %}
                        {{ comment_form.as_p }}
                        <button type="submit" class="btn-submit">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                <path
                                    d="M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576 6.636 10.07Zm6.787-8.201L1.591 6.602l4.339 2.76 7.494-7.493Z" />
                            </svg>
                            Post Comment
                        </button>
                    </form>
                    {% else %}
                    <div class="login-prompt">
                        <p>Please <a href="{% url 'login' %}">log in</a> to leave a comment.</p>
                    </div>
                    {% endif %}
                </div>
            </section>

            <div class="back-navigation">
                <a href="{% url 'blog:index' %}" class="back-link">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z" />
                    </svg>
                    Back to All Posts
                </a>
            </div>
        </div>
    </article>
</div>

<style>
    .post-detail-container {
        max-width: 900px;
        margin: 0 auto;
        padding: 40px 20px;
    }

    .post-article {
        background: var(--bg-card);
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    }

    .post-hero-image {
        width: 100%;
        height: 450px;
        overflow: hidden;
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-hover) 100%);
    }

    .post-hero-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .post-content-wrapper {
        padding: 50px;
    }

    .post-header {
        margin-bottom: 40px;
        border-bottom: 2px solid var(--border-color);
        padding-bottom: 30px;
    }

    .category-pill {
        display: inline-block;
        background: linear-gradient(135deg, var(--primary), var(--primary-hover));
        color: white;
        padding: 6px 16px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 20px;
    }

    .post-title {
        font-size: 3rem;
        font-weight: 800;
        line-height: 1.2;
        color: var(--text-main);
        margin: 0 0 20px 0;
    }

    .post-meta {
        display: flex;
        align-items: center;
        gap: 12px;
        color: var(--text-muted);
        font-size: 0.95rem;
    }

    .post-meta svg {
        margin-right: 4px;
        vertical-align: middle;
    }

    .post-meta .separator {
        color: var(--border-color);
    }

    .post-body {
        font-size: 1.125rem;
        line-height: 1.8;
        color: var(--text-main);
        margin-bottom: 40px;
    }

    .post-body p {
        margin-bottom: 1.5em;
    }

    /* Engagement Bar */
    .engagement-bar {
        display: flex;
        align-items: center;
        gap: 20px;
        padding: 20px 0;
        border-top: 2px solid var(--border-color);
        border-bottom: 2px solid var(--border-color);
        margin-bottom: 30px;
    }

    .like-section .like-form {
        margin: 0;
    }

    .like-button,
    .like-disabled {
        display: flex;
        align-items: center;
        gap: 8px;
        background: transparent;
        border: 2px solid var(--border-color);
        padding: 10px 20px;
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 1rem;
        font-weight: 600;
        color: var(--text-main);
    }

    .like-button:hover {
        border-color: #ff4757;
        background: rgba(255, 71, 87, 0.1);
        transform: scale(1.05);
    }

    .heart-icon {
        font-size: 1.2rem;
    }

    .share-section {
        position: relative;
    }

    .share-trigger {
        display: flex;
        align-items: center;
        gap: 8px;
        background: transparent;
        border: 2px solid var(--border-color);
        padding: 10px 20px;
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.3s;
        font-weight: 600;
        color: var(--text-main);
    }

    .share-trigger:hover {
        border-color: var(--primary);
        background: rgba(13, 110, 253, 0.1);
    }

    .share-dropdown {
        position: absolute;
        top: 100%;
        left: 0;
        margin-top: 10px;
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        padding: 8px;
        min-width: 200px;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition: all 0.3s;
        z-index: 100;
    }

    .share-section:hover .share-dropdown {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }

    .share-btn {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 16px;
        border-radius: 8px;
        text-decoration: none;
        color: var(--text-main);
        transition: all 0.2s;
        border: none;
        background: transparent;
        width: 100%;
        text-align: left;
        cursor: pointer;
        font-size: 0.95rem;
    }

    .share-btn:hover {
        background: rgba(13, 110, 253, 0.1);
        color: var(--primary);
    }

    /* Author Actions */
    .author-actions {
        display: flex;
        gap: 12px;
        margin-bottom: 30px;
        flex-wrap: wrap;
    }

    .btn-action {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 10px 20px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s;
        border: none;
        cursor: pointer;
        font-size: 0.95rem;
    }

    .btn-action.edit {
        background: var(--primary);
        color: white;
    }

    .btn-action.edit:hover {
        background: var(--primary-hover);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(13, 110, 253, 0.3);
    }

    .btn-action.delete {
        background: #dc3545;
        color: white;
    }

    .btn-action.delete:hover {
        background: #c82333;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
    }

    .btn-action.clear-likes {
        background: #ffc107;
        color: #000;
    }

    .btn-action.clear-likes:hover {
        background: #e0a800;
    }

    /* Comments Section */
    .comments-section {
        margin-top: 60px;
    }

    .section-title {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 1.75rem;
        font-weight: 700;
        margin-bottom: 30px;
        color: var(--text-main);
    }

    .comments-list {
        margin-bottom: 40px;
    }

    .comment-card {
        background: var(--bg-body);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 20px;
        transition: all 0.3s;
    }

    .comment-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        transform: translateY(-2px);
    }

    .comment-header {
        margin-bottom: 16px;
    }

    .comment-author {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary), var(--primary-hover));
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 1.1rem;
    }

    .author-info strong {
        display: block;
        color: var(--text-main);
        font-size: 1rem;
    }

    .comment-date {
        display: block;
        color: var(--text-muted);
        font-size: 0.85rem;
        margin-top: 2px;
    }

    .comment-body {
        color: var(--text-main);
        line-height: 1.6;
    }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: var(--text-muted);
    }

    .empty-state svg {
        margin-bottom: 20px;
    }

    /* Comment Form */
    .comment-form-card {
        background: var(--bg-body);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 30px;
    }

    .comment-form-card h3 {
        font-size: 1.25rem;
        font-weight: 700;
        margin-bottom: 20px;
        color: var(--text-main);
    }

    .comment-form textarea {
        width: 100%;
        min-height: 120px;
        padding: 16px;
        border: 2px solid var(--border-color);
        border-radius: 8px;
        background: var(--bg-card);
        color: var(--text-main);
        font-family: inherit;
        font-size: 1rem;
        resize: vertical;
        transition: all 0.3s;
    }

    .comment-form textarea:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.1);
    }

    .btn-submit {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        background: var(--primary);
        color: white;
        border: none;
        padding: 12px 28px;
        border-radius: 8px;
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s;
        margin-top: 16px;
    }

    .btn-submit:hover {
        background: var(--primary-hover);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(13, 110, 253, 0.3);
    }

    .login-prompt {
        text-align: center;
        padding: 30px;
        color: var(--text-muted);
    }

    .login-prompt a {
        color: var(--primary);
        font-weight: 600;
    }

    /* Back Navigation */
    .back-navigation {
        margin-top: 50px;
        padding-top: 30px;
        border-top: 2px solid var(--border-color);
    }

    .back-link {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        color: var(--text-muted);
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s;
    }

    .back-link:hover {
        color: var(--primary);
        transform: translateX(-4px);
    }

    /* Responsive */
    @media (max-width: 768px) {
        .post-content-wrapper {
            padding: 30px 20px;
        }

        .post-title {
            font-size: 2rem;
        }

        .post-hero-image {
            height: 250px;
        }

        .engagement-bar {
            flex-direction: column;
            align-items: flex-start;
        }

        .author-actions {
            flex-direction: column;
        }

        .btn-action {
            width: 100%;
            justify-content: center;
        }
    }
</style>
{% endblock %}